## 常见的安全漏洞

## 一、XSS 跨站脚本攻击

XSS(Cross-Site Scripting，跨站脚本攻击)是一种代码注入攻击。攻击者在目标网站上注入恶意代码，当被攻击者登陆网站时就会执行这些恶意代码，这些脚本可以读取 cookie，session tokens，或者其它敏感的网站信息，对用户进行钓鱼欺诈，甚至发起蠕虫攻击等。

XSS 的本质是：恶意代码未经过滤，与网站正常的代码混在一起；浏览器无法分辨哪些脚本是可信的，导致恶意脚本被执行。由于直接在用户的终端执行，恶意代码能够直接获取用户的信息，利用这些信息冒充用户向网站发起攻击者定义的请求。

## 1.反射型 XSS(非持久)

**原理：反射性xss一般** **指攻击者通过特定的方式来诱惑受害者去访问一个包含恶意代码的URL。当受害者点击恶意链接url的时候，恶意代码会直接在受害者的主机上的浏览器执行**

**攻击步骤：**

1. 攻击者在url后面的参数中加入恶意攻击代码。
2. 当用户打开带有恶意代码的URL的时候，网站服务端将恶意代码从URL中取出，拼接在html中并且返回给浏览器端。
3. 用户浏览器接收到响应后执行解析，其中的恶意代码也会被执行到。
4. 攻击者通过恶意代码来窃取到用户数据并发送到攻击者的网站。攻击者会获取到比如cookie等信息，然后使用该信息来冒充合法用户的行为，调用目标网站接口执行攻击等操作。

**演示：恶意链接获取用户cookie**

****

**攻击后做什么：实现无密码登录，流量劫持**

**预防：**

-   过滤：对<script>、<img>、<a>等标签进行过滤。
-   编码：编码进行转换
-   不要点击陌生链接

## 2.存储型 XSS(持久)

**原理：主要是将恶意代码上传或存储到服务器中，下次只要受害者浏览包含此恶意代码的页面就会执行恶意代码。**

****

**攻击步骤：**

1. 攻击者将恶意代码提交到目标网站数据库中。
2. 用户打开目标网站时，网站服务器将恶意代码从数据库中取出，然后拼接到html中返回给浏览器中。
3. 用户浏览器接收到响应后解析执行，那么其中的恶意代码也会被执行。
4. 那么恶意代码执行后，就能获取到用户数据，比如上面的cookie等信息，那么把该cookie发送到攻击者网站中，那么攻击者拿到该cookie然后会冒充该用户的行为，调用目标网站接口等违法操作。

**演示：留言板发送恶意代码**

****

**预防**

-   后端需要对提交的数据进行过滤。
-   前端也可以做一下处理方式，比如对script标签，将特殊字符替换成HTML编码这些等。

[

](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYvetteLau%2FBlog%2Ftree%2Fmaster%2FSecurity)

## 3.Dom 型 XSS

**原理：** **我们客户端的js可以对页面dom节点进行动态的操作，比如插入、修改页面的内容。比如说客户端从URL中提取数据并且在本地执行、如果用户在客户端输入的数据包含了恶意的js脚本的话，但是这些脚本又没有做任何过滤处理的话，那么我们的应用程序就有可能受到DOM-based XSS的攻击。**

****

**攻击步骤：**

1. 攻击者构造出特殊的URL、在其中可能包含恶意代码。
2. 用户打开带有恶意代码的URL。
3. 用户浏览器收到响应后解析执行。前端使用js取出url中的恶意代码并执行。
4. 执行时，恶意代码窃取用户数据并发送到攻击者的网站中，那么攻击者网站拿到这些数据去冒充用户的行为操作。调用目标网站接口执行攻击者一些操作。

**演示：输入评论内容**

****

**预防：**

-   **内容进行转译**

****

## 二、SQL注入

**原理：SQL注入是通过客户端的输入把SQL命令注入到一个应用的数据库中，从而执行恶意的SQL语句。**


**什么意思呢？我们来打个比方：我们有一个登录框，需要输入用户名和密码对吧，然后我们的密码输入 'or '123' = '123 这样的。
****我们在查询用户名和密码是否正确的时候，本来执行的sql语句是：select * from user where username = '' and password = ''. 这样的sql语句，现在我们输入密码是如上这样的，然后我们会通过参数进行拼接，拼接后的sql语句就是：select * from user where username = '' and password = ' ' or '123' = '123 '; 这样的了，那么会有一个or语句，只要这两个有一个是正确的话，就条件成立，因此 123 = 123 是成立的。因此验证就会被跳过。这只是一个简单的列子，比如还有密码比如是这样的：'; drop table user;, 这样的话，那么sql命令就变成了：select * from user where username = '' and password = ''; drop table user;' , 那么这个时候我们会把user表直接删除了。sql被攻击的原因是：sql语句伪造参数，然后对参数进行拼接后形成xss攻击的sql语句。最后会导致数据库被攻击了。**

****

**防范的方法：**
1. 我们可以使用预编译语句(PreparedStatement，这样的话即使我们使用sql语句伪造成参数，到了服务端的时候，这个伪造sql语句的参数也只是简单的字符，并不能起到攻击的作用。
2. 数据库中密码不应明文存储的，可以对密码使用md5进行加密，为了加大破解成本，所以可以采用加盐的方式。

## 三、CSRF 跨站请求伪造

**原理：CSRF（Cross-site request forgery）跨站请求伪造：攻击者诱导受害者进入第三方网站，在第三方网站中，向被攻击网站发送跨站请求。利用受害者在被攻击网站已经获取的注册凭证，绕过后台的用户验证，达到冒充用户对被攻击的网站执行某项操作的目的。**

****

**典型的CSRF 攻击流程**

1.  受害者登录 A 站点，并保留了登录凭证（Cookie）。
1.  攻击者诱导受害者访问了站点 B。
1.  站点 B 向站点 A 发送了一个请求，浏览器会默认携带站点 A 的 Cookie 信息。
1.  站点 A 接收到请求后，对请求进行验证，并确认是受害者的凭证，误以为是无辜的受害者发送的请求。
1.  站点 A 以受害者的名义执行了站点 B 的请求。
1.  攻击完成，攻击者在受害者不知情的情况下，冒充受害者完成了攻击。

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0d95fbc86bf04585b2fb27db38a6d3a2~tplv-k3u1fbpfcp-zoom-1.image)

**CSRF 的特点**

1.攻击通常在第三方网站发起，如图上的站点 B，站点 A 无法防止攻击发生。

2.攻击利用受害者在被攻击网站的登录凭证，冒充受害者提交操作；并不会去获取 cookie 信息(cookie 有同源策略)

3.跨站请求可以用各种方式：图片 URL、超链接、CORS、Form 提交等等(来源不明的链接，不要点击)

**防御手段**

1.  添加验证码(体验不好)
1.  判断请求的来源：检测 Referer(并不安全，Referer 可以被更改)
1.  使用 Token(主流)
1.  Samesite Cookie 属性

## 四、点击劫持

**原理：点击劫持是指在一个 Web 页面中隐藏了一个透明的 iframe，用外层假页面诱导用户点击，实际上是在隐藏的 frame 上触发了点击事件进行一些用户不知情的操作。**

****

**典型点击劫持攻击流程**

1.  攻击者构建了一个非常有吸引力的网页【不知道哪些内容对你们来说有吸引力，我就不写页面了，偷个懒】
1.  将被攻击的页面放置在当前页面的 iframe 中
1.  使用样式将 iframe 叠加到非常有吸引力内容的上方
1.  将 iframe 设置为 100%透明
1.  你被诱导点击了网页内容，你以为你点击的是*，而实际上，你成功被攻击了。

-   防御手段

**1. frame busting**

 ( top.location != window.location ){ top.location = window.location } 复制代码

需要注意的是: HTML5 中 iframe 的 sandbox 属性、IE 中 iframe 的 security 属性等，都可以限制 iframe 页面中的 JavaScript 脚本执行，从而可以使得 frame busting 失效。

**2. X-Frame-Options**

X-FRAME-OPTIONS 是微软提出的一个 http 头，专门用来防御利用 iframe 嵌套的点击劫持攻击。并且在 IE8、Firefox3.6、Chrome4 以上的版本均能很好的支持。

可以设置为以下值:

-   DENY: 拒绝任何域加载
-   SAMEORIGIN: 允许同源域下加载
-   ALLOW-FROM: 可以定义允许 frame 加载的页面地址

## 五、本地数据窃取

**原理：直接打开chrom 浏览器 appction 修改读取 cookie 、localStorage、sessionStorage**

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ae614c869de74702bcfca477f8c9398b~tplv-k3u1fbpfcp-zoom-1.image)

**防范：**

数据加密、脱敏处理，不保存敏感数据在storage里

##

## 六、安全检测工具

上面我们介绍了几种常见的前端安全漏洞，也了解一些防范措施，那么我们如何发现自己网站的安全问题呢？没有安全部门的公司可以考虑下面几款开源扫码工具：

1. Arachni

Arachni是基于Ruby的开源，功能全面，高性能的漏洞扫描框架，Arachni提供简单快捷的扫描方式，只需要输入目标网站的网址即可开始扫描。它可以通过分析在扫描过程中获得的信息，来评估漏洞识别的准确性和避免误判。

Arachni默认集成大量的检测工具，可以实施 代码注入、CSRF、文件包含检测、SQL注入、命令行注入、路径遍历等各种攻击。

同时，它还提供了各种插件，可以实现表单爆破、HTTP爆破、防火墙探测等功能。

针对大型网站，该工具支持会话保持、浏览器集群、快照等功能，帮助用户更好实施渗透测试。

2. Mozilla HTTP Observatory

Mozilla HTTP Observatory，是Mozilla最近发布的一款名为Observatory的网站安全分析工具，意在鼓励开发者和系统管理员增强自己网站的安全配置。用法非常简单：输入网站URL，即可访问并分析网站HTTP标头，随后可针对网站安全性提供数字形式的分数和字母代表的安全级别。

检查的主要范围包括：

-   Cookie
-   跨源资源共享（CORS）
-   内容安全策略（CSP）
-   HTTP公钥固定（Public Key Pinning）
-   HTTP严格安全传输（HSTS）状态
-   是否存在HTTP到HTTPs的自动重定向
-   子资源完整性（Subresource Integrity）
-   X-Frame-Options
-   X-XSS-Protection